pipeline{
agent any

  stages{
  
    stage("Git Checkout"){
      steps{
          git branch: 'J2EE', credentialsId: 'GitID', url: 'https://github.com/shreemansandeep/javaonlinebookstore.git'
    }
}

stage("Unit testing"){
       steps{
              sh 'mvn test'
             }
        }
        
 stage("Integration testing"){
                steps{
                      sh 'mvn verify -DskipUnitTests'
                }
        }

stage("Maven Build"){
      steps{
          sh "mvn clean package"
  
    }
}

stage("Static code analysis"){
            
           steps{
            script{
                withSonarQubeEnv(credentialsId: 'sonar-token') {
                            sh 'mvn clean install sonar:sonar'
                      }
                     }
                   }
                  }
                  
  stage("Quality Gate Status"){
            
           steps{
            script{
                waitForQualityGate abortPipeline: false, credentialsId: 'sonar-token'
                     }
                   }
                  }
                  
   stage("Upload War To Nexus"){
            
           steps{
            script{
                nexusArtifactUploader artifacts: [
                [
                    artifactId: 'onlinebookstore', 
                    classifier: '', 
                    file: 'target/onlinebookstore-0.1.war', 
                    type: 'war'
                  ]
                ], 
                credentialsId: 'nexus-auth', 
                groupId: 'onlinebookstore', 
                nexusUrl: '43.205.135.54:8081', 
                nexusVersion: 'nexus3', 
                protocol: 'http', 
                repository: 'onlinebookown-release', 
                version: '0.1'
                     }
                   }
                  }


}
}
